# Dashboard cliente You Body ‚Äî redesign

## Obiettivi
- Far percepire valore e cura del brand del salone fin dal primo accesso.
- Rendere evidenti promozioni attive e slot last-minute da confermare entro 60 minuti.
- Semplificare prenotazioni, gestione pacchetti e punti fedelt√† in un unico flusso.
- Garantire continuit√† con il tema dinamico per salone (vedi `civiappdoc/branding/...`).

## Contesto applicativo
- UI attuale: `ClientDashboardScreen` in `lib/presentation/screens/client/client_dashboard_screen.dart` con `NavigationBar` a 4 tab (Home, Appuntamenti, Pacchetti, Punti) e `ClientBookingSheet` per prenotazioni.
- Dati disponibili tramite `appDataProvider` (AppDataStore): clienti, appuntamenti, servizi, vendite, pacchetti, notifiche.
- Branding dinamico gi√† integrato con `salonThemeProvider`; evitare hard-code di colori non coerenti.
- Il redesign mantiene la struttura a tab ma aggiorna la Home e introduce componenti riutilizzabili per promozioni e slot urgenti.

## Linee guida UI
- Stile: minimal premium, respiro, card radius 12-16 px, ombre livello 1-2 (Material 3 elevation 1/2). Icone outline di Material.
- Palette: base chiara (surface, background) con primario You Sand/Black dal tema dinamico. Stati: Success `#22AA77`, Warning `#FFAA00`, Danger `#EE3333` (da modulare con `Theme.of(context)` se possibile).
- Tipografia: H1 28 px/Poppins o Manrope, H2 22 px, body Inter/Roboto 14-16 px. Utilizzare `theme.textTheme` per rispettare le impostazioni runtime.
- Layout: header sticky con saluto, sezioni a blocchi verticali, bottom-nav sempre visibile. Prevedere stato portrait mobile come riferimento principale.

## Struttura Home (tab index 0)
1. Header saluto + prossimo appuntamento
   - Testo "Ciao, {nome} üëã" in AppBar, con pulsante menu (drawer) gi√† presente.
   - Card riepilogo con: servizio, data/ora (formato locale), sede, CTA `Riprenota`, `Sposta`, `Annulla` che riusano `ClientBookingSheet` e `AppDataStore` (`_rescheduleAppointment`, `_cancelAppointment`).
   - Stato vuoto: card illustrata o placeholder con copy "Nessun appuntamento prenotato. Scopri gli slot last-minute ‚Üì" e CTA `Prenota ora`.
2. Promozioni in corso
   - Hero carousel 1-3 card large (immagine soft, titolo, percentuale). Pulsante primario `Scopri l'offerta` -> deep link/pagina promo.
   - Badge "Fino al {dd/MM}". Prevedere lazy load con placeholder shimmer.
   - Dati da nuova collezione `promotions` (Firestore) o API `/promotions?active=true&limit=5` come da sezione dati.
   - Se assenti: card info "Nessuna promozione attiva" + link a storie/archivio.
3. Last-minute entro 60 minuti
   - Titolo sezione "Ultima chiamata ‚è≥ Entro 60 min" con badge countdown globale.
   - Filtri chip: Tutti, VacuFIT, Viso, Corpo, Epilazione. Implementare come `FilterChip` con stato locale/Riverpod.
   - Lista/griglia 2 colonne (responsive). Ogni card: ora inizio, servizio, durata, operatore/cabina, countdown mm:ss, badge `- {discount}%`, prezzo barrato vs scontato, punti guadagnati.
   - CTA `Prenota ora` -> apre `ClientBookingSheet` con slot precompilato, auto-applica sconto e pagamento veloce (Apple/Google Pay se attivo).
   - Link secondario `Vedi tutti gli slot nelle prossime 2 ore` -> naviga tab Appuntamenti filtrato.
   - Stato vuoto: illustrazione + toggle `Attiva notifiche Last-Minute` con bottom sheet preferenze (categoria, giorni, fasce orarie) -> POST `/alerts/lastminute`.
4. Azioni rapide
   - Griglia 2x2 o carosello chip: `Prenota trattamento`, `Rinnova abbonamento`, `Wallet & Gift`, `Chat nutrizionista` (placeholder se non attiva).
   - Ogni azione invoca sheet o naviga tab corrispondente. Reuse `NavigationBar` setState oppure `GoRouter` named route.
5. Progressi / Abbonamento
   - Card motivazionale con progresso pacchetto corrente: sedute rimanenti, prossima milestone (es. "manca 1 seduta per bonus"), CTA `Usa una seduta`, `Vedi piano`.
   - Stato vuoto: suggerimento acquisto pacchetto con CTA `Scopri pacchetti`.
6. Disponibilit√† VacuFIT
   - Micro calendario orizzontale (oggi/domani) con slot rapidi 45'. CTA `Prenota 45'` o `Lista d'attesa`.
   - Richiede dataset `services` taggati VacuFIT + `appointments` liberi -> calcolo lato client/app server.
   - Se feature non attiva per salone: card informativa nascosta di default.
7. Wallet, punti & gift
   - Preview saldo punti (conversione 1 punto = ‚Ç¨0,10), gift attive, coupon salvati.
   - CTA `Usa punti` -> apre tab Punti con sezione redemption.
8. Articoli/consigli personalizzati (opzionale dopo blocchi commerciali)
   - Max 3 card editoriali: pelle, corpo, nutrizione. Link esterni o blog interno.
9. Navigazione inferiore
   - `NavigationBar` esistente con 4 voci. Valutare 5a voce `VacuFIT` quando la feature sar√† consistente (>40% utenti). Preparare icona `fitness_center`.

## Flusso Last-minute (dettaglio)
- Finestra di visibilit√†: slot prenotabili 60-15 minuti prima dell'inizio. Pricing dinamico: 15% (60-46 min), 20% (45-31), 25% (30-16), 30% (<=15). Applicare hard floor prezzo minimo configurabile.
- Disponibilit√†: mostrare solo slot con cabina e operatore liberi, rispettando setup time del servizio. Calcolo preferibile lato backend; in assenza usare generazione client e validazione via Function.
- Checkout espresso: tap `Prenota ora` -> bottom sheet con riepilogo, selezione pagamento veloce, applicazione punti/gift (default off). Conferma in massimo 3 step. Output: toast "Prenotato! Ci vediamo alle {ora}" + CTA `Aggiungi a calendario`, `Apri mappa`.
- Policy no-show: copy fisso "Last-Minute non rimborsabile. Puoi cedere lo slot a un amico fino a 10 minuti prima." + link clausole.

## Stati e micro-interazioni
- Card on tap: micro-scale 1.02, shadow livello 3 per 120 ms con curva `easeOut`.
- Countdown: animazione tick 1 s. Quando <10 min badge lampeggia (alpha 70-100%) per 600 ms.
- Scheletri loading: shimmer su card promo e card slot (3 placeholder) dopo 300 ms.
- Empty state: illustrazione vector leggera + CTA utile per ogni sezione.
- Error state: banner non invasivo con `SnackBar` o `InfoBar` + azione retry.
- Haptics: feedback leggero su conferma prenotazione mobile.

## Accessibilita e performance
- Contrasto minimo WCAG AA, target touch >=44 px, testi scalabili (rispettare `MediaQuery.textScaler`).
- Supporto screen reader: label countdown "Mancano {n} minuti"; CTA con aria-label.
- Lazy load immagini promozioni, caching lista slot 30 s con revalidate.
- Obiettivo LCP <2.5 s su rete 4G, CLS <0.1. Considerare `AnimatedSwitcher` per transizioni leggere.

## Dati e API (contratti di riferimento)
- GET `/promotions?active=true&limit=5` -> `[ { id, title, subtitle, tagline, endsAt, imageUrl, ctaUrl, discount } ]`.
- GET `/lastminute?window=60&serviceType=all` -> `[ { slotId, service, startAt, duration, room, operator, basePrice, discountPct, priceNow, seats, loyaltyPoints } ]`.
- POST `/booking/express` `{ slotId, paymentToken, usePoints, giftId }` -> `{ bookingId, calendarUrl }`.
- GET `/user/summary` -> `{ nextBooking, planProgress, points, giftsCount }`.
- POST `/alerts/lastminute` `{ categories, days, timeRanges, radiusKm }`.
- Integrare con `AppDataStore` creando repository dedicati (`PromotionsRepository`, `LastMinuteRepository`) e stream Riverpod.

## Telemetria (Firebase Analytics / Segment)
- `Promo_Impression`, `Promo_Click` con `promotion_id`.
- `LM_Slot_Impression`, `LM_Slot_Filter`, `LM_Slot_Countdown_bucket` (60-46, 45-31, 30-16, <=15).
- `LM_Buy_Click`, `Checkout_Express_Start`, `Checkout_Express_Success`, `Checkout_Fail` (param `reason`).
- `Notif_Enable_LastMinute`, `Notif_Delivery_Click`.
- `Wallet_UsePoints`, `Wallet_UseGift`.

## Roadmap suggerita
1. Estendere AppDataStore con repository promo/last-minute e modelli dati dedicati.
2. Aggiornare Home tab introducendo sezioni promo/last-minute dietro feature flag per saloni pilota.
3. Introdurre azioni rapide e card progressi pacchetto riusando dati esistenti (`ClientPackagePurchase`).
4. Validare UX e performance (test su dispositivi medi, monitor LCP) prima del rollout generale.

## Extra (nice-to-have)
- Spin-to-Win elegante quando non ci sono slot last-minute (premio: +5% extra).
- Share-to-unlock: condividi promo -> accredito 5 punti fedelt√†.
- Lista d'attesa smart: se si libera uno slot <60 min invia push con deep link checkout.
